<section class="products">
  <header class="toolbar">
    <h1>Products</h1>

    <div class="filters">
      <input
        type="text"
        placeholder="Search products…"
        [ngModel]="search()"
        (ngModelChange)="onSearchChange($event)"
        (keyup.enter)="onSearchEnter()" />
    </div>

    <div class="advanced-filters">
      <input
        type="number"
        placeholder="Min price"
        [ngModel]="priceMin()"
        (ngModelChange)="priceMin.set($event); onFilterChange()" />

      <input
        type="number"
        placeholder="Max price"
        [ngModel]="priceMax()"
        (ngModelChange)="priceMax.set($event); onFilterChange()" />

      <select [ngModel]="availability()" (ngModelChange)="availability.set($event); onFilterChange()">
        <option value="all">All</option>
        <option value="in">In stock</option>
        <option value="out">Out of stock</option>
      </select>

      <select [ngModel]="category()" (ngModelChange)="category.set($event); onFilterChange()">
        <option *ngFor="let c of categoryOptions" [value]="c.value">
          {{ c.label }}
        </option>
      </select>
    </div>
  </header>

  <div *ngIf="showTopLoading()" class="loading">Loading…</div>
  <div *ngIf="error() as err" class="error">{{ err }}</div>

  <div class="grid" *ngIf="!error()">
    <article
      class="card"
      *ngFor="let p of filteredItems(); trackBy: trackById"
      [routerLink]="['/products', p.id]">
      <div class="thumb">
        <img *ngIf="p.imageUrl" [src]="p.imageUrl" [alt]="p.name" />
      </div>
      <div class="body">
        <div class="title" [title]="p.name">{{ p.name }}</div>
        <p class="desc" [title]="p.description">{{ p.description }}</p>
        <div class="meta">
          <span class="price">{{ p.price | currency: 'USD' }}</span>
          <span class="badge" [class.ok]="p.available === true">
            {{ p.available ? 'In stock' : 'Out of stock' }}
          </span>
        </div>
      </div>
    </article>
  </div>

  <div #infiniteAnchor></div>

  <div *ngIf="showBottomLoading()" class="loading bottom-loading">Loading more…</div>
  <button
    *ngIf="showBackToTop()"
    class="back-to-top"
    (click)="scrollToTop()"
    aria-label="Back to top"
    title="Back to top">
    ↑
  </button>
</section>
